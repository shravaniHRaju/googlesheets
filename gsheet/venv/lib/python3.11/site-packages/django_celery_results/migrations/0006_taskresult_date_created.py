# Generated by Django 2.2.4 on 2019-08-21 19:53

import django.utils.timezone
from django.db import migrations, models


def copy_date_done_to_date_created(apps, schema_editor):
    TaskResult = apps.get_model('django_celery_results', 'taskresult')
    db_alias = schema_editor.connection.alias
    for task_result in TaskResult.objects.using(db_alias).all():
        task_result.date_created = task_result.date_done
        task_result.save()


def reverse_copy_date_done_to_date_created(apps, schema_editor):
    # Since the migration is irreversible, we won't define a reverse operation
    pass


class Migration(migrations.Migration):

    dependencies = [
        ('django_celery_results', '0005_taskresult_worker'),
    ]

    operations = [
        migrations.AddField(
            model_name='taskresult',
            name='date_created',
            field=models.DateTimeField(
                auto_now_add=True,
                db_index=True,
                help_text='Datetime field when the task result was created in UTC',
                verbose_name='Created DateTime'
            ),
            preserve_default=False,
        ),
        migrations.RunPython(copy_date_done_to_date_created,
                             reverse_code=reverse_copy_date_done_to_date_created),
    ]
